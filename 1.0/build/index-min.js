/*! pwdstrength - v1.0 - 2013-09-24 7:19:34 PM
* Copyright (c) 2013 弘树; Licensed  */
KISSY.add("gallery/pwdstrength/1.0/index",function(a,b,c){function d(a){var b=this;d.superclass.constructor.call(b,a),b.init()}var e="",f=b.all;return a.extend(d,c,{init:function(){var a=this;a.renderUI(),a.bindEvent()},renderUI:function(){var a=this,b=a.get("needRender"),c=a.get("html");if(b&&""!=c){var d=a.get("triggerNode"),e=f(c),g=a.get("renderType");switch(g){case"insert":d.after(e);break;case"popup":var h=d.offset(),i=d.outerWidth(),j=d.outerHeight(),k=10;f(document.body).append(e),e.css({position:"absolute",display:"none",left:h.left+i+k,top:h.top+(j-e.height())/2})}this.boundingBox=e}},bindEvent:function(){var b=this,c=b.get("triggerNode"),d=(b.get("needRender"),b.boundingBox),g=b.get("onchange"),h=b.get("onblur");a.isFunction(g)&&c.on("change keypress paste focus textInput input",function(){var a=f(this).val(),c=0;a!=e&&(b.password=f(this).val(),c=b.level()),g.call(b,c,d)}),a.isFunction(h)&&c.on("focusout blur",function(){h.call(b,d)})},regex:{illegal:/[^-+=|,0-9a-zA-Z!@#$%^&*?_.~+/\\(){}\[\]<>]/g,allNumber:/^\d+$/,allLetter:/^[a-zA-Z]+$/,allCharacter:/^[-+=|,!@#$%^&*?_.~+/\\(){}\[\]<>]+$/,allSame:/^([\s\S])\1*$/,number:/\d/g,letter:/[a-zA-Z]/g,lowerAndUpperLetter:/[a-z][^A-Z]*[A-Z]|[A-Z][^a-z]*[a-z]/,numberAndLetter:/\d[^a-zA-Z]*[a-zA-Z]|[a-zA-Z][^\d]*\d/,character:/[-+=|,!@#$%^&*?_.~+/\\()|{}\[\]<>]/g},level:function(){var b=this,c=0;if(b.isIllegal())return c;var d=this.size();4>=d?c+=5:d>4&&8>d?c+=10:d>=8&&(c+=25);var e=this.hasLowerAndUpperLetter(),f=this.hasLetter();e?c+=20:f&&(c+=10);var g=this.hasNumber();g>=3?c+=20:g&&(c+=10);var h=this.hasCharacter();h>=3?c+=25:h&&(c+=10),e&&g&&h?c+=10:f&&g&&h?c+=5:(f&&g||f&&h||g&&h)&&(c+=2);var i=b.get("rule");return a.each(i,function(a,b){return c>a?(c=i.length-(b+1),!1):void 0}),c},size:function(){return this.password.length},isIllegal:function(){return!!this.password.match(this.regex.illegal)},isAllNumber:function(){return!!this.password.match(this.regex.allNumber)},isAllLetter:function(){return!!this.password.match(this.regex.allLetter)},isAllCharacter:function(){return!!this.password.match(this.regex.allCharacter)},isAllSame:function(){return!!this.password.match(this.regex.allSame)},hasNumber:function(){return(this.password.match(this.regex.number)||[]).length},hasLetter:function(){return(this.password.match(this.regex.letter)||[]).length},hasLowerAndUpperLetter:function(){return!!this.password.match(this.regex.lowerAndUpperLetter)},hasNumberAndLetter:function(){return!!this.password.match(this.regex.numberAndLetter)},hasCharacter:function(){return(this.password.match(this.regex.character)||[]).length}},{ATTRS:{triggerNode:{value:null,setter:function(b){return a.isString(b)?f(b):b}},rule:{value:[70,30,0]},html:{value:'<div class="pwdstrength-popup"><em class="popup-arrow"></em><div class="popup-content"><div class="pwdstrength-wrap">\u5bc6\u7801\u5f3a\u5ea6\uff1a<span class="strenth-wrap"><span class="strength-bar"></span></span></div></div></div>',setter:function(a){var b=this,c=b.get("needRender"),d=b.get("renderType");return c&&"popup"==d&&(a='<div class="pwdstrength-popup"><em class="popup-arrow"></em><div class="popup-content">'+a+"</div></div>"),a}},needRender:{value:!0},renderType:{value:"popup",setter:function(b){var c=this,d=c.get("needRender"),e=["insert","popup"];return d||a.log("If needRender is false, no need for setting renderType!","warn"),a.inArray(b,e)?b:(a.log("The renderType you set is not supported yet, please check and retry!","error"),d[0])}},onchange:{value:function(b,c){function d(a){return a>16?a.toString(16):"0"+a.toString(16)}for(var e=[255,0,0],f=[31,165,66],g=[],h=this,i=c.one(".strenth-wrap").width(),j=h.get("rule").length,k=b/j,l=0;3>l;l++)g[l]=parseInt(e[l]-(e[l]-f[l])*k);var m="";a.each(g,function(a){m+=d(a)}),c.one(".strength-bar").css({width:i*k+"px",backgroundColor:"#"+m}),c.show()}},onblur:{value:function(a){a.hide()}}}}),d},{requires:["node","base","event"]});